local Testing = true

-- Constants
local Services = {
    RP = game:GetService("ReplicatedStorage"),
    Players = game:GetService("Players"),
}

local Variables = {
    HostUser = getgenv().HostUser,
    Player = game.Players.LocalPlayer,
}

-- GUI Setup (Only for Testing)
if not Testing then
    local main = Instance.new("ScreenGui")
    -- Add GUI elements here...
    main.Parent = game.CoreGui
end

-- Load Anti-Cheat Bypass
loadstring(game:HttpGet("https://raw.githubusercontent.com/MsorkyScripts/OpenSourceAntiCheat/main/AntiCheatBypass.txt"))()
getgenv().Executed = true

-- Functions

local function Drop(Type)
	if Type == true and CmdSettings["Dropping"] == nil then
		CmdSettings["Dropping"] = true
		CmdSettings["CustomDrop"] = nil
		CmdSettings["Aura"] = nil
		while CmdSettings["Dropping"] do
			local args = {
				[1] = "DropMoney",
				[2] = "10000"
			}
			game:GetService("ReplicatedStorage").MainEvent:FireServer(unpack(args))
			wait(2.5)
		end
	elseif Type == false then
		CmdSettings["Dropping"] = nil
		CmdSettings["CustomDrop"] = nil
	end
end

local function AirLock(Type)
    if CmdSettings["AirLock"] == nil and Type == true then
		local BP = Variables["Player"].Character.HumanoidRootPart:FindFirstChild("AirLockBP")
		if BP then
			BP:Destroy()
		end
		CmdSettings["AirLock"] = true
		Variables["Player"].Character.HumanoidRootPart.CFrame = Variables["Player"].Character.HumanoidRootPart.CFrame*CFrame.new(0,10,0)
		local BP = Instance.new("BodyPosition",Variables["Player"].Character.HumanoidRootPart)
		BP.Name = "AirLockBP"
		BP.MaxForce = Vector3.new(math.huge,math.huge,math.huge)
		BP.Position = Variables["Player"].Character.HumanoidRootPart.Position
	elseif CmdSettings["AirLock"] == true and Type == false then
		CmdSettings["AirLock"] = nil
		local BP = Variables["Player"].Character.HumanoidRootPart:FindFirstChild("AirLockBP")
		if BP then
			BP:Destroy()
		end
	end
end

local function GetPlayerFromString(str, ignore)
    if Player and Player == game.Players.LocalPlayer then
        if game.CoreGui:FindFirstChild("RenderScreen") then
            game.CoreGui.RenderScreen:Destroy()
        end
end

local function BringPlr(Target, POS)
    -- Bring player logic here...
end

local function Setup(Type, Debugmode)
    CmdSettings["Aura"] = nil
	if Debugmode then
		for PointInTable = 1,40 do
			local Table = SetupsTable[Type]

			game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = Table["Origin"]

			local XAxis 
			local ZAxis
			local i 
			if PointInTable <= 10 then
				i = 1
			elseif PointInTable <= 20 then
				i = 2
			elseif PointInTable <= 30 then
				i = 3
			elseif PointInTable <= 40 then
				i = 4
			end
			if i == 1 then
				if PointInTable <= Table["PerRow"]   then
					XAxis = 0
					if PointInTable == 1 then
						ZAxis = 0
					else
						ZAxis = (PointInTable-1)*Table["ZMultiplier"]
					end

				end
			else
				local index = i*Table["PerRow"]
				if (Table["PerRow"]*i) >= PointInTable then
					XAxis = (i-1)*Table["XMultiplier"]
					ZAxis = (i*Table["PerRow"]-PointInTable)*Table["ZMultiplier"]

				end
			end


			game.Players.LocalPlayer.Character.Archivable = true
			local clone = game.Players.LocalPlayer.Character:Clone()
			clone.Parent = workspace
			clone.HumanoidRootPart.CFrame = Table["Origin"]*CFrame.new(XAxis,0,ZAxis)
		end
	else
end

local function ShowWallet()
    local Player = game.Players.LocalPlayer
	if Player.Backpack:FindFirstChild("Wallet") then
		Player.Character.Humanoid:EquipTool(Player.Backpack.Wallet)
	end
end

local function RemoveWallet()
	local Player = game.Players.LocalPlayer
	if Player.Character:FindFirstChild("Wallet") then
		Player.Character.Humanoid:UnequipTools()
	end
end

-- Chat Command Handling
local function HandleChatCommand(data)
    local Message = data.Message
    local plr = game:service("Players")[data.FromSpeaker]

    if plr.Name ~= getgenv().HostUser then
        return
    end

    Message = string.lower(Message)
    local Args = string.split(Message, " ")
    local AmountOfArgs = #Args

    if Host and not Crashed and Variables.Player.Character and Variables.Player.Character:FindFirstChild("HumanoidRootPart") and Variables.Player.Character:FindFirstChild("Humanoid") and Variables.Player.Character.Humanoid.Health > 0 then
        if Args[1] == ".drop" then
            Drop(true)
        elseif not CmdSettings["AdOn"] and Args[1] == ".ad" and Args[2] == "on" then
            local newStr = string.gsub(Message, ".ad on", "")
				CmdSettings["AdOn"] = true
				while CmdSettings["AdOn"] do
					game.ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(newStr, 'All'); 
					wait(1.5)	
				end
        elseif Message == ".ad off" then
            CmdSettings["AdOn"] = nil
        elseif Message == ".loopdel" then
            if DropFolder then
                DropFolder:Destroy()
                DropFolder = nil
            end
        elseif Message == ".circle host" and Host and Host.Character and Host.Character:FindFirstChild("Humanoid") and Host.Character.Humanoid.Health > 0 then
            local angle = 0
				local cfr = Host.Character.HumanoidRootPart.CFrame*CFrame.new(0,1,0)
				local Index = 0
				local size = 3

				local PointInTable = getgenv().PointInTable

				local ZAxis
				local angle = 0
				if PointInTable <= 10 then
					ZAxis = 2
					angle = (10-PointInTable)
				elseif PointInTable <= 20 then
					ZAxis = -1
					angle = (20-PointInTable)
				elseif PointInTable <= 30 then
					ZAxis = -4
					angle = (30-PointInTable)
				elseif PointInTable <= 40 then
					ZAxis = -8
					angle = (40-PointInTable)
				end
                -- more organized
        elseif Args[1] == ".stopdrop" then
            Drop(false)
        elseif Args[1] == ".reset" then
            if Variables["Player"].Character then
                local FULLY_LOADED_CHAR = Variables["Player"].Character:FindFirstChild("FULLY_LOADED_CHAR")
                if FULLY_LOADED_CHAR then
                    FULLY_LOADED_CHAR.Parent = Services["RP"]
                    FULLY_LOADED_CHAR:Destroy()
                end
                Variables["Player"].Character:Destroy()
            end
        elseif Args[1] == ".airlock" then
            AirLock(true)
        elseif Args[1] == ".stopairlock" then
            AirLock(false)
        elseif Message == ".setup bank" then
            Setup("Bank")
        elseif Message == ".setup admin" then
            Setup("Admin")
        elseif Message == ".setup klub" then
            Setup("Klub")
        elseif Message == ".setup vault" then
            Setup("Vault")
        elseif Message == ".setup train" then
            Setup("Train")
        elseif Message == ".wallet on" then
            ShowWallet()
        elseif Message == ".wallet off" then
            RemoveWallet()
        elseif Message == ".maskon" then
            local plr = game.Players.LocalPlayer
				local c = plr.Character
				local Root = c.PrimaryPart
				local OldCF = Root.CFrame

				local Tries = 0 
				repeat wait(0.1) Tries += 1
					Root.CFrame = workspace.Ignored.Shop["[Surgeon Mask] - $25"].Head.CFrame*CFrame.new(math.random(-1,1),0,math.random(-1,1))
					fireclickdetector(workspace.Ignored.Shop["[Surgeon Mask] - $25"].ClickDetector)
				until Tries >= 50 or not c or not c:FindFirstChild("Humanoid") or c:FindFirstChild"Mask" or plr.Backpack:FindFirstChild"Mask"
				wait(0.5)
				if plr.Backpack:FindFirstChild("Mask") then
					c.Humanoid:EquipTool(plr.Backpack.Mask)
					c.Mask:Activate()
				elseif c:FindFirstChild("Mask") then
					c.Mask:Activate()
				end
        elseif Message == ".maskoff" then
            local plr = game.Players.LocalPlayer
				local c = plr.Character
				local Root = c.PrimaryPart

				if plr.Backpack:FindFirstChild("Mask") then
					c.Humanoid:EquipTool(plr.Backpack.Mask)
					c.Mask:Activate()
				elseif c:FindFirstChild("Mask") then
					c.Mask:Activate()
				end
